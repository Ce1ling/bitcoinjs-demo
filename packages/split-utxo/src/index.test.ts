import { describe, test, expect } from '@jest/globals'

import { SplitUtxo } from '.'

describe('SplitUtxo', () => {
  const utxo = new SplitUtxo({
    wif: 'cP5qpxwUrhB2pfGELF9NSfP16hUtMAithVmasdc6UeYLTMxWHteR',
    network: 'testnet',
    feeRate: 500,
    utxo: {
      hash: 'c2311f03ee0313f579a4aa1af29a134febc9b1261da4375070974b1ed11878d4',
      index: 3,
      value: 6247,
    },
  })

  test('should be a p2tr address', () => {
    expect(utxo.payment.address).toBe(
      'tb1pagakxe22c92q5msgh9v7zznjjry4ylgatyuyyu9qq3mrwk804aeqvwc26h'
    )
  })

  // https://mempool.space/testnet4/tx/c2311f03ee0313f579a4aa1af29a134febc9b1261da4375070974b1ed11878d4
  // https://mempool.space/testnet4/tx/f735a63d05b1ee7ce03cd221d96ef951a9ef49547dd3e5a13534465053c1e7cc
  test('biuld split tx hex', () => {
    const psbt = utxo.split(10)
    console.log('tx vSize:', psbt.virtualSize())
    console.log('tx hex:', psbt.toHex())
    expect(psbt.toHex()).toBe(
      '02000000000101d47818d11e4b97705037a41d26b1c9eb4f139af21aaaa479f51303ee031f31c20300000000fdffffff0a3e02000000000000225120ea3b63654ac1540a6e08b959e10a7290c9527d1d59384270a004763758efaf723e02000000000000225120ea3b63654ac1540a6e08b959e10a7290c9527d1d59384270a004763758efaf723e02000000000000225120ea3b63654ac1540a6e08b959e10a7290c9527d1d59384270a004763758efaf723e02000000000000225120ea3b63654ac1540a6e08b959e10a7290c9527d1d59384270a004763758efaf723e02000000000000225120ea3b63654ac1540a6e08b959e10a7290c9527d1d59384270a004763758efaf723e02000000000000225120ea3b63654ac1540a6e08b959e10a7290c9527d1d59384270a004763758efaf723e02000000000000225120ea3b63654ac1540a6e08b959e10a7290c9527d1d59384270a004763758efaf723e02000000000000225120ea3b63654ac1540a6e08b959e10a7290c9527d1d59384270a004763758efaf723e02000000000000225120ea3b63654ac1540a6e08b959e10a7290c9527d1d59384270a004763758efaf723e02000000000000225120ea3b63654ac1540a6e08b959e10a7290c9527d1d59384270a004763758efaf720140df66bfb027934a9369ecc67253219104c43cb5fed0822ba9c1b72fca3a8901c490427881847676c7264a54abd3614cc0e42f50efe9a45b6cb84b0de4b24a74e700000000'
    )
  })
})
